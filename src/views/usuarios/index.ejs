<h1>Listado de Usuarios</h1>

<form class="form" action="/usuarios" method="GET">
    <div class="form_group" style="display: flex; gap: 10px; margin-bottom: 20px;">
        <input
            class="form_input"
            type="search"
            name="q"
            id="search"
            placeholder="Buscar por nombre o correo..."
            style="flex-grow: 1;"
            value="<%= locals.searchTerm %>"
        />
        <button class="button button--secondary" type="submit">Buscar</button>
        <a class="button" href="/usuarios">Ver Todos</a>
    </div>
</form>

<a class="button button--primary" href="/usuarios/create"
>Crear un usuario</a
>

<section class="usuarios">
    <% if (usuarios.length === 0 && searchTerm) { %>
        <p>No se encontraron usuarios para la búsqueda: **<%= searchTerm %>**</p>
    <% } else if (usuarios.length === 0) { %>
        <p>No hay usuarios registrados.</p>
    <% } else { %>
        <table>
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Fecha de Creación</th> <th>Contraseña</th> 
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <% usuarios.forEach(usuario => { %>
                <tr>
                    <td>
                        <a href="/usuarios/<%= usuario.id %>"><%= usuario.nombre %></a>
                    </td>
                    <td><%= usuario.email %></td>
                    <td><%= new Date(usuario.fecha_creacion).toLocaleDateString() %></td> 
                    <td>********</td>
                    <td class="cell-inline">
                        <a
                            class="edit"
                            href="/usuarios/<%= usuario.id %>/edit"
                        >Editar</a
                        >
                        <form
                            class="form-delete"
                            action="/usuarios/<%= usuario.id %>?_method=DELETE"
                            method="post"
                        >
                            <button class="button button--danger" type="submit">Borrar</button>
                        </form>
                    </td>
                </tr>
                <% }) %>
            </tbody>
        </table>
    <% } %>
</section>

<script>
    document.addEventListener("submit", (event) => {
        if (event.target.classList.contains("form-delete")) {
            event.preventDefault(); // Previene el envío inmediato
            if (confirm("¿Está seguro de que desea eliminar este usuario (Soft Delete)?")) {
                event.target.submit();
            }
        }
    });
</script>